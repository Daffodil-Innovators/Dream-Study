<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="user_dashboard_admission_ac" name="Dashboard">
        <t t-call="website.layout">
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
                    rel="stylesheet"
                    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
                    crossorigin="anonymous"/>

            <!-- Define current user and student -->
            <t t-set="user_id" t-value="request.env.user"/>
            <t t-set="student_profile"
                t-value="request.env['dsl.study.student'].sudo().search([('partner_id', '=', user_id.partner_id.id)], limit=1)"/>

            <!-- Show only if student profile exists -->
            <t t-if="student_profile">
                <div class="student-dashboard mt-3">
                    <div class="container">
                        <h5>
                            <a href="/my/home/dashboard" class="text-dark fw-bolder">
                                <i class="fa fa-home"></i> Home
                            </a>
                        </h5>

                        <h4>
                            Hello <span t-out="user_id.name"/> , Welcome to Student Dashboard
                        </h4>

                        <div>
                            <div class="row mt-4">
                                <!-- Left Sidebar -->
                                <div class="col-md-3 col-12">
                                    <div class="card shadow border-0 p-3">
                                        <div class="profile-image d-flex justify-content-center">
                                            <t t-if="student_profile.photo">
                                                <img t-attf-src="data:image/png;base64,{{ student_profile.photo.decode('utf-8') }}"
                                                     style="width:100px;height:100px;border-radius:50%" alt=""/>
                                            </t>
                                            <t t-else="">
                                                <img src="https://upload.wikimedia.org/wikipedia/commons/9/9e/Male_Avatar.jpg"
                                                     style="width:120px;height:100px;border-radius:50%" alt=""/>
                                            </t>
                                        </div>
                                        <div class="profile-name mt-2">
                                            <p class="text-center text-capitalize fs-5 fw-bold">
                                                <t t-esc="student_profile.first_name"/> <t t-esc="student_profile.middle_name"/> <t t-esc="student_profile.last_name"/>
                                            </p>
                                            <p class="text-center small">
                                                <i class="fa fa-phone" aria-hidden="true"></i>
                                                <t t-esc="user_id.partner_id.phone"/>
                                            </p>
                                            <p class="text-center small">
                                                <i class="fa fa-envelope" aria-hidden="true"></i>
                                                <t t-esc="user_id.partner_id.email"/>
                                            </p>

                                            <div class="profile-menu pt-0 ps-2 pe-2">
                                                <p class="active">
                                                    <a href="/my/dashboard" class="text-dark">
                                                        <i class="fa fa-home pe-3" aria-hidden="true"></i> Dashboard
                                                    </a>
                                                </p>
                                                <p>
                                                    <a href="/student/profile" class="text-dark">
                                                        <i class="fa fa-pencil-square pe-3" aria-hidden="true"></i> Profile Update
                                                    </a>
                                                </p>
                                                <p>
                                                    <a href="/slides" class="text-dark">
                                                        <i class="fa fa-graduation-cap pe-2" aria-hidden="true"></i> TrainHub
                                                    </a>
                                                </p>
                                                <p>
                                                    <a href="/my/security" class="text-dark">
                                                        <i class="fa fa-wrench pe-3" aria-hidden="true"></i> Reset Password
                                                    </a>
                                                </p>
                                                <p>
                                                    <a href="/web/session/logout" class="text-dark">
                                                        <i class="fa fa-sign-out pe-3" aria-hidden="true"></i> Log Out
                                                    </a>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Main Content: Only My Payments -->
                                <div class="col-md-9 col-12">
                                    <div class="d-flex align-items-center mb-3">
                                        <img src="https://assets.applyboard.com/app/students/assets/c24e50db8ceb229009ddef74fa0b4734.svg" alt=""
                                             style="width:50px;height:50px;"/>
                                        <h2 class="ps-3">My Payments</h2>
                                    </div>

                                    <div class="card p-4 shadow-sm border-0" style="border-radius:10px;">
                                        <p class="fw-bold mb-1">Total Invoices:</p>
                                        <h4 class="text-primary"><t t-esc="student_invoices"/></h4>

                                        <a href="/my/invoices" class="btn btn-primary mt-3">
                                            View My Invoices
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>

            <!-- JS and Toastr scripts -->
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"/>

            <script type="text/javascript">
                $(document).ready(function () {
                    function displayMessage() {
                        var urlParams = new URLSearchParams(window.location.search);
                        var error = urlParams.get('error');
                        var success = urlParams.get('success');

                        if (error) toastr.error(error, 'Error');
                        if (success) {
                            toastr.success(success, 'Success');
                            clearParam('success');
                        }
                    }

                    function clearParam(param) {
                        var url = new URL(window.location.href);
                        url.searchParams.delete(param);
                        history.replaceState(null, '', url.toString());
                    }

                    displayMessage();
                });
            </script>
        </t>
    </template>
</odoo>
